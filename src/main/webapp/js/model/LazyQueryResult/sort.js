/**
 * Copyright (c) Codice Foundation
 *
 * This is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser
 * General Public License as published by the Free Software Foundation, either version 3 of the
 * License, or any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
 * even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details. A copy of the GNU Lesser General Public License
 * is distributed along with this program and can be found at
 * <http://www.gnu.org/licenses/lgpl.html>.
 *
 **/
import { StartupDataStore } from '../Startup/startup';
function parseMultiValue(value) {
    if (value && value.constructor === Array) {
        return value[0];
    }
    return value;
}
function isEmpty(value) {
    return value === undefined || value === null;
}
function parseValue(value, attribute) {
    var attributeDefinition = StartupDataStore.MetacardDefinitions.getAttributeMap()[attribute];
    if (!attributeDefinition) {
        return value.toString().toLowerCase();
    }
    switch (attributeDefinition.type) {
        case 'DATE':
        case 'BOOLEAN':
            return value;
        case 'STRING':
            return value.toString().toLowerCase();
        default:
            return parseFloat(value);
    }
}
function compareValues(aVal, bVal, sorting) {
    var sortOrder = sorting.direction === 'descending' ? -1 : 1;
    aVal = parseValue(aVal, sorting.attribute);
    bVal = parseValue(bVal, sorting.attribute);
    if (aVal < bVal) {
        return sortOrder * -1;
    }
    if (aVal > bVal) {
        return sortOrder;
    }
    return 0;
}
function checkSortValue(a, b, sorting) {
    var aVal = parseMultiValue(a.plain.metacard.properties[sorting.attribute]);
    var bVal = parseMultiValue(b.plain.metacard.properties[sorting.attribute]);
    if (isEmpty(aVal) && isEmpty(bVal)) {
        return 0;
    }
    if (isEmpty(aVal)) {
        return 1;
    }
    if (isEmpty(bVal)) {
        return -1;
    }
    return compareValues(aVal, bVal, sorting);
}
export var generateCompareFunction = function (sorting) {
    if (!sorting) {
        throw new Error("Sorting can't be undefined!");
    }
    return function (a, b) {
        var sortValue = 0;
        for (var i = 0; i <= sorting.length - 1; i++) {
            var sortField = sorting[i].attribute;
            var sortOrder = sorting[i].direction === 'descending' ? -1 : 1;
            switch (sortField) {
                case 'RELEVANCE':
                    sortValue = sortOrder * (a.plain.relevance - b.plain.relevance);
                    break;
                case 'DISTANCE':
                    // this says distance could be null, could be a bug we need to address
                    // @ts-expect-error ts-migrate(2531) FIXME: Object is possibly 'null'.
                    sortValue = sortOrder * (a.plain.distance - b.plain.distance);
                    break;
                default:
                    sortValue = checkSortValue(a, b, sorting[i]);
            }
            if (sortValue !== 0) {
                break;
            }
        }
        return sortValue;
    };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29ydC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3NyYy9tYWluL3dlYmFwcC9qcy9tb2RlbC9MYXp5UXVlcnlSZXN1bHQvc29ydC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7SUFhSTtBQUVKLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLG9CQUFvQixDQUFBO0FBSXJELFNBQVMsZUFBZSxDQUFDLEtBQVU7SUFDakMsSUFBSSxLQUFLLElBQUksS0FBSyxDQUFDLFdBQVcsS0FBSyxLQUFLLEVBQUU7UUFDeEMsT0FBTyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUE7S0FDaEI7SUFDRCxPQUFPLEtBQUssQ0FBQTtBQUNkLENBQUM7QUFFRCxTQUFTLE9BQU8sQ0FBQyxLQUFVO0lBQ3pCLE9BQU8sS0FBSyxLQUFLLFNBQVMsSUFBSSxLQUFLLEtBQUssSUFBSSxDQUFBO0FBQzlDLENBQUM7QUFFRCxTQUFTLFVBQVUsQ0FBQyxLQUFVLEVBQUUsU0FBaUI7SUFDL0MsSUFBTSxtQkFBbUIsR0FDdkIsZ0JBQWdCLENBQUMsbUJBQW1CLENBQUMsZUFBZSxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUE7SUFDbkUsSUFBSSxDQUFDLG1CQUFtQixFQUFFO1FBQ3hCLE9BQU8sS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFBO0tBQ3RDO0lBQ0QsUUFBUSxtQkFBbUIsQ0FBQyxJQUFJLEVBQUU7UUFDaEMsS0FBSyxNQUFNLENBQUM7UUFDWixLQUFLLFNBQVM7WUFDWixPQUFPLEtBQUssQ0FBQTtRQUNkLEtBQUssUUFBUTtZQUNYLE9BQU8sS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFBO1FBQ3ZDO1lBQ0UsT0FBTyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUE7S0FDM0I7QUFDSCxDQUFDO0FBRUQsU0FBUyxhQUFhLENBQUMsSUFBUyxFQUFFLElBQVMs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LE9BQU8sU0FBUyxDQUFBO0lBQ2xCLENBQUMsQ0FBQTtBQUNILENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBDb2RpY2UgRm91bmRhdGlvblxuICpcbiAqIFRoaXMgaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXJcbiAqIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlXG4gKiBMaWNlbnNlLCBvciBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0XG4gKiBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZSBHTlVcbiAqIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuIEEgY29weSBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBpcyBkaXN0cmlidXRlZCBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbSBhbmQgY2FuIGJlIGZvdW5kIGF0XG4gKiA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2xncGwuaHRtbD4uXG4gKlxuICoqL1xuXG5pbXBvcnQgeyBTdGFydHVwRGF0YVN0b3JlIH0gZnJvbSAnLi4vU3RhcnR1cC9zdGFydHVwJ1xuaW1wb3J0IHsgTGF6eVF1ZXJ5UmVzdWx0IH0gZnJvbSAnLi9MYXp5UXVlcnlSZXN1bHQnXG5pbXBvcnQgeyBRdWVyeVNvcnRUeXBlIH0gZnJvbSAnLi90eXBlcydcblxuZnVuY3Rpb24gcGFyc2VNdWx0aVZhbHVlKHZhbHVlOiBhbnkpIHtcbiAgaWYgKHZhbHVlICYmIHZhbHVlLmNvbnN0cnVjdG9yID09PSBBcnJheSkge1xuICAgIHJldHVybiB2YWx1ZVswXVxuICB9XG4gIHJldHVybiB2YWx1ZVxufVxuXG5mdW5jdGlvbiBpc0VtcHR5KHZhbHVlOiBhbnkpIHtcbiAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IG51bGxcbn1cblxuZnVuY3Rpb24gcGFyc2VWYWx1ZSh2YWx1ZTogYW55LCBhdHRyaWJ1dGU6IHN0cmluZykge1xuICBjb25zdCBhdHRyaWJ1dGVEZWZpbml0aW9uID1cbiAgICBTdGFydHVwRGF0YVN0b3JlLk1ldGFjYXJkRGVmaW5pdGlvbnMuZ2V0QXR0cmlidXRlTWFwKClbYXR0cmlidXRlXVxuICBpZiAoIWF0dHJpYnV0ZURlZmluaXRpb24pIHtcbiAgICByZXR1cm4gdmFsdWUudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpXG4gIH1cbiAgc3dpdGNoIChhdHRyaWJ1dGVEZWZpbml0aW9uLnR5cGUpIHtcbiAgICBjYXNlICdEQVRFJzpcbiAgICBjYXNlICdCT09MRUFOJzpcbiAgICAgIHJldHVybiB2YWx1ZVxuICAgIGNhc2UgJ1NUUklORyc6XG4gICAgICByZXR1cm4gdmFsdWUudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpXG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBwYXJzZUZsb2F0KHZhbHVlKVxuICB9XG59XG5cbmZ1bmN0aW9uIGNvbXBhcmVWYWx1ZXMoYVZhbDogYW55LCBiVmFsOiBhbnksIHNvcnRpbmc6IFF1ZXJ5U29ydFR5cGUpIHtcbiAgY29uc3Qgc29ydE9yZGVyID0gc29ydGluZy5kaXJlY3Rpb24gPT09ICdkZXNjZW5kaW5nJyA/IC0xIDogMVxuICBhVmFsID0gcGFyc2VWYWx1ZShhVmFsLCBzb3J0aW5nLmF0dHJpYnV0ZSlcbiAgYlZhbCA9IHBhcnNlVmFsdWUoYlZhbCwgc29ydGluZy5hdHRyaWJ1dGUpXG4gIGlmIChhVmFsIDwgYlZhbCkge1xuICAgIHJldHVybiBzb3J0T3JkZXIgKiAtMVxuICB9XG4gIGlmIChhVmFsID4gYlZhbCkge1xuICAgIHJldHVybiBzb3J0T3JkZXJcbiAgfVxuICByZXR1cm4gMFxufVxuXG5mdW5jdGlvbiBjaGVja1NvcnRWYWx1ZShcbiAgYTogTGF6eVF1ZXJ5UmVzdWx0LFxuICBiOiBMYXp5UXVlcnlSZXN1bHQsXG4gIHNvcnRpbmc6IFF1ZXJ5U29ydFR5cGVcbikge1xuICBjb25zdCBhVmFsID0gcGFyc2VNdWx0aVZhbHVlKGEucGxhaW4ubWV0YWNhcmQucHJvcGVydGllc1tzb3J0aW5nLmF0dHJpYnV0ZV0pXG4gIGNvbnN0IGJWYWwgPSBwYXJzZU11bHRpVmFsdWUoYi5wbGFpbi5tZXRhY2FyZC5wcm9wZXJ0aWVzW3NvcnRpbmcuYXR0cmlidXRlXSlcbiAgaWYgKGlzRW1wdHkoYVZhbCkgJiYgaXNFbXB0eShiVmFsKSkge1xuICAgIHJldHVybiAwXG4gIH1cbiAgaWYgKGlzRW1wdHkoYVZhbCkpIHtcbiAgICByZXR1cm4gMVxuICB9XG4gIGlmIChpc0VtcHR5KGJWYWwpKSB7XG4gICAgcmV0dXJuIC0xXG4gIH1cbiAgcmV0dXJuIGNvbXBhcmVWYWx1ZXMoYVZhbCwgYlZhbCwgc29ydGluZylcbn1cblxuZXhwb3J0IGNvbnN0IGdlbmVyYXRlQ29tcGFyZUZ1bmN0aW9uID0gKHNvcnRpbmc6IFF1ZXJ5U29ydFR5cGVbXSkgPT4ge1xuICBpZiAoIXNvcnRpbmcpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFNvcnRpbmcgY2FuJ3QgYmUgdW5kZWZpbmVkIWApXG4gIH1cbiAgcmV0dXJuIGZ1bmN0aW9uIChhOiBMYXp5UXVlcnlSZXN1bHQsIGI6IExhenlRdWVyeVJlc3VsdCkge1xuICAgIGxldCBzb3J0VmFsdWUgPSAwXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gc29ydGluZy5sZW5ndGggLSAxOyBpKyspIHtcbiAgICAgIGNvbnN0IHNvcnRGaWVsZCA9IHNvcnRpbmdbaV0uYXR0cmlidXRlXG4gICAgICBjb25zdCBzb3J0T3JkZXIgPSBzb3J0aW5nW2ldLmRpcmVjdGlvbiA9PT0gJ2Rlc2NlbmRpbmcnID8gLTEgOiAxXG4gICAgICBzd2l0Y2ggKHNvcnRGaWVsZCkge1xuICAgICAgICBjYXNlICdSRUxFVkFOQ0UnOlxuICAgICAgICAgIHNvcnRWYWx1ZSA9IHNvcnRPcmRlciAqIChhLnBsYWluLnJlbGV2YW5jZSAtIGIucGxhaW4ucmVsZXZhbmNlKVxuICAgICAgICAgIGJyZWFrXG4gICAgICAgIGNhc2UgJ0RJU1RBTkNFJzpcbiAgICAgICAgICAvLyB0aGlzIHNheXMgZGlzdGFuY2UgY291bGQgYmUgbnVsbCwgY291bGQgYmUgYSBidWcgd2UgbmVlZCB0byBhZGRyZXNzXG5cbiAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIHRzLW1pZ3JhdGUoMjUzMSkgRklYTUU6IE9iamVjdCBpcyBwb3NzaWJseSAnbnVsbCcuXG4gICAgICAgICAgc29ydFZhbHVlID0gc29ydE9yZGVyICogKGEucGxhaW4uZGlzdGFuY2UgLSBiLnBsYWluLmRpc3RhbmNlKVxuICAgICAgICAgIGJyZWFrXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgc29ydFZhbHVlID0gY2hlY2tTb3J0VmFsdWUoYSwgYiwgc29ydGluZ1tpXSlcbiAgICAgIH1cbiAgICAgIGlmIChzb3J0VmFsdWUgIT09IDApIHtcbiAgICAgICAgYnJlYWtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHNvcnRWYWx1ZVxuICB9XG59XG4iXX0=